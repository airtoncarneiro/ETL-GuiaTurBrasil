AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: |
  guia-tur-bra
  Funcao que faz a raspagem dos dados da pagina das cidades

Globals:
  Function:
    Environment:
      Variables:
        REGION_NAME: us-east-1

Resources:
  CidadesFunction:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: CidadesFunction
      CodeUri: lambdas/cidades
      Handler: app.lambda_handler
      Runtime: python3.10
      Timeout: 20
      MemorySize: 128
      Layers:
        - !Ref FetchLayer
        - !Ref MyLibsLayer
      Environment:
        Variables:
          SQS_QUEUE_URL: !GetAtt CidadesQueue.QueueUrl
      Policies:
        - Statement:
            Effect: Allow
            Action: sqs:SendMessage
            Resource: !GetAtt CidadesQueue.Arn

  FetchLayer:
    Type: AWS::Serverless::LayerVersion
    Properties:
      LayerName: guia-tur-brasil-libs
      ContentUri: layers/guia-libs
      CompatibleRuntimes:
        - python3.10
      RetentionPolicy: Retain
    Metadata:
      BuildMethod: python3.10

  MyLibsLayer:
    Type: AWS::Serverless::LayerVersion
    Properties:
      LayerName: guia-tur-brasil-mylibs
      ContentUri: layers/my_libs
      CompatibleRuntimes:
        - python3.10
      RetentionPolicy: Retain
    Metadata:
      BuildMethod: python3.10

  CidadesQueue:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: CidadesQueue

Outputs:
  CidadesQueueUrl:
    Value: !Ref CidadesQueue
    Export:
      Name: CidadesQueueUrl